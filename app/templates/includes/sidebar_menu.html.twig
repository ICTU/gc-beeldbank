{#
We call a macro which calls itself to render the full tree.
@see http://twig.sensiolabs.org/doc/tags/macro.html
#}

{% import _self as menus %}

{{ menus.menu_links(items, 0) }}

{% macro menu_links(items, menu_level) %}

  {% import _self as menus %}

  {% if items %}
    {% if menu_level == 0 %}
      <ul class="main-menu__list">
    {% elseif menu_level == 1 %}
      <ul class="main-menu__sublist">
    {% else %}
      <ul>
    {% endif %}

    {% for item in items %}

      {% set name = item['info']['subdir_name'] ? item['info']['subdir_name'] : item['info']['name'] %}

      {% set menuItemClasses = [
        'main-menu__item',
        menu_level >= 1  ? 'main-menu__item--sub',
        item[item['subdir_name']] and menu_level == 0 ? 'main-menu__item--with-sub'
      ] %}

      <li class="{{ menuItemClasses|classlist }}">

        {% set linkClasses = [
          'main-menu__link',
          menu_level >= 1  ? 'main-menu__link--sub' : 'main-menu__link--main',
        ] %}

        <a class="{{ linkClasses|classlist }}"
           href="#{{ item['id'] }}">{{ name }}</a>

        {% if item[item['subdir_name']] %}
          {% set subitems = item[item['subdir_name']] %}

          {{ menus.menu_links(subitems, menu_level + 1) }}
        {% endif %}
      </li>
    {% endfor %}
    </ul>
  {% else %}
  {% endif %}

{% endmacro %}